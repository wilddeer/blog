# SendGrid катится к хуям

## Чё за сендгрид?

Сендгрид — это <abbr title="Бузинес ту бузинес">B2B</abbr>-сервис для рассылки почты. Все эти «confirm your email address» и «новости нашего сраного стартапа» обычно посылаются через таких ребят. Еще из известных есть мейлган, мейлчимп, постмарк, амазон сес — наверняка что-то слышали.

Сендгрид год назад был куплен Twilio, компанией с многомиллиардной капитализацией. Сириуз бизнес, можно положиться на таких ребят.

## А вы чё?

В [Чатре](https://chatra.com), помимо «ресет ёр пассворд», есть несколько функций, плотно завязанных на отсылку емейлов: в чате это отправка непрочитанных ответов саппорта на почту посетителю, симметричная штука — отправка непрочитанных сообщений посетителя на почту саппорта; в почте это, собственно, отправка почтовых сообщений от саппорта.

Все это до недавнего времени работало через сендгрид.

И вот одним прекрасным вечером, часов так в 11, у нас падают прод тесты на отправку емейлов. Примем этот момент за начало инцидента.

### Начало инцидента {.arrow-header}

Тут надо сказать, что письма через сендгрид могли зачастую идти пару минут, а иногда и больше. И в тесте у нас была трехминутная пауза перед проверкой почты, но и она не всегда спасала, были ложные фейлы тестов, но почта в итоге доходила.

Если подумать, то это ужасная скорость доставки, особенно если при регистрации требуется подтвердить емейл. Но мы не требуем сразу подтвердить емейл, поэтому в нашем процессе регистрации это не было узким местом.

Так вот, я залезаю в телефон, чтобы убедиться, что срабатывание ложное. Но нет, почта все ещё не дошла. Регистрирую новый акк в Чатре — письмо не приходит. Рефрешу почту минут 5. Блять.

Встаю, чешу жопу и иду за комп. Лезу в сендгрид и вижу это:

![](fuck_you_too,_sendgrid.png)
{.is-ootb}

Что, блядь? Эти уебки просто взяли и заблочили нам почту? Мы шлем миллионы сообщений в месяц, платим этим мудакам дохуя денег, у нас в их собственной системе рейтинга 98% «всё охуенно, вы совсем не спамеры», и они просто блокируют нам отсылку почты в продакшене без предупреждений?

В саппорт-чат моментально улетает вопрос «какого хуя» (с более культурными английскими эпитетами, так как пишу не я), на что саппорт мнется и отвечает, что наш вопрос очень важен, ай хэв эливейтед ёр тикет приорити. Тикет приорити при этом остаётся где-то в районе «нихуя не срочно», саппорт откровенно пиздит:

![](escalated_as_fuck.png)

На любые дополнительные вопросы саппорт кормит нас голубцами с говном.

### 2 часа с начала инцидента {.arrow-header}

Становится понятно, что ребята в сендгриде массируют свои соски от нашего баттхерта, и в ближайшее время ничего не решится, надо что-то делать самим.

![](https://media.giphy.com/media/gaZ51cn7sUY4U/giphy-downsized-large.gif)

Мы вспоминаем, что по счастливой случайности у нас завалялся ещё один аккаунт сендгрида для сайдпроектов. Он не заблочен, достаточно поменять апи-ключ, чтобы отправить туда весь поток наших емейлов, но это стремно по двум причинам:

1.  Мы до сих пор не знаем, какого хуя нас забанили. Не хочется стриггерить бан и на втором аккаунте и потерять любую возможность быстро восстановить отправку почты.
2.  Резкая отправка почты с новых айпи-адресов может сильно просадить доставляемость почты, потому что почтовики привыкли получать нашу почту с наших выделенных айпи, оставшихся в основном акке.

    Если вы не понимаете, о чем речь, добро пожаловать в ебанутый мир суперлегаси технологии, обмазанной невероятными костылями, — электронной почты.

На второй пункт сейчас в целом насрать, потому что какая-то доставляемость лучше никакой доставляемости. Но получить второй бан от сервиса, платящим, сука блядь, <del>клиентом</del> заложником которого ты являешься, стремно.

В течение ночи я плавно перевожу отправку почты на запасной акк. К утру весь функционал восстанавливается, акк не забанен. Ура, блядь. Можно поспать.

### 16 часов с начала инцидента {.arrow-header}

Аккаунт все ещё забанен, в тикете тишина. Поразительно, насколько им просто похуй на платящих клиентов. Что у них там, блядь, происходит?

Очевидно, что надо срочно валить на другой сервис. Пока я изучал альтернативы, [Тёме](https://twitter.com/artpolikarpov) кто-то подсказал попробовать [Постмарк](https://postmarkapp.com/). После такого факапа с сендгридом я изучил про постмарк буквально всё: чё за компания, чё за основатели, сколько клиентов, сколько зарабатывают, весь сайт до дыр.

Чуваки оставили очень приятное ощущение того, что их ебет, что они делают:

- они гордятся скоростью доставки почты и показывают реалтаймовые данные о скорости доставки прямо на ленде,
- там же на ленде они показывают рейтинг саппорта и обещают отвечать в течение пары часов,
- они очень парятся за свою репутацию как отправителя, и поэтому строго разделяют транзакционные письма и почтовые рассылки (настолько строго, что до недавнего времени вообще не занимались почтовыми рассылками, а теперь шлют рассылки с отдельного пула айпи и очень рекомендуют использовать для них отдельный поддомен),
- они не пытаются развести на покупку выделенных айпи и прямо говорят, что большинству выделенные айпи не нужны, а шейред айпи с хорошим рейтингом будут работать на доставляемость почты гораздо лучше.

И ещё то, что меня сильно зацепило: они прямо на ленде пишут, что они privately owned and profitable. И вот почему.

### Блядские черные дыры для инвестиций

Большинство силиконоводолинных компаний сейчас развиваются не ради пользователей, а ради инвесторов.

Кажется, что если развивать продукт для пользователей, пользователи кинут в вас деньгами, будет прибыль, инвесторы будут рады и тоже кинут в вас деньгами на дальнейшее развитие.

На практике сейчас все работает не так. Задача компании — показать инвесторам не прибыль, а потенциал прибыли. Инвесторы радостно это кушают и продолжают кидать деньгами в компанию, остающуюся убыточной десятилетиями.

Компания получает очередной раунд инвестиций, CEO покупает себе новый бугатти, а на оставшиеся деньги максимально раздувается пользовательская база, чтобы можно было показать растущий потенциал инвесторам, чтобы они занесли ещё денег. Круг замыкается.

При этом компания скупает рекламу ковровой бомбардировкой, и ей совершенно не важно, что цена привлечения пользователя в продукт может в разы превышать средний livetime value привлечённого пользователя.

От этого страдают компании, которые живут на прибыль (ого, так бывает?), потому что они не могут соревнования в цене за клик по рекламе с ковровыми бомбардировщиками. Но это уже другая история.

Как вы уже догадались, сендгрид — именно такая компания-мразь, существующая не для клиента, а для инвестора. Ей совершенно поебать на тебя, клиент ебаный. Твой энтерпрайз-тариф — копейки по сравнению с очередным раундом инвестиций.

В общем, переходим на Постмарк.

### 2 дня с начала инцидента {.arrow-header}

Вся почта переведена на Постмарк.

Саппорт Постмарка действительно отвечает очень быстро, и отвечает не очередной агент&nbsp;248. Отвечает человек, который разбирается в продукте и в почте в целом, у него есть все необходимые доступы ко всем внутренним инструментам, чтобы тебе помочь, и он прям берет и помогает. Не создает тебе тикет, не эскалирует его, а прям вот отвечает тебе сразу.

Выглядит это все, конечно, совсем не серьезно, недостаточно бюрократично и энтерпрайзно. Но у нас в Чатре вот прям такой же саппорт для людей, так что мы _как-нибудь переживем_.

А еще у Постмарка хороший приятный интерфейс. Им удобно и классно пользоваться. Он не идеален, но видно, что сделан с любовью и вниманием к деталям. Для сравнения, интерфейс сендгрида — типичный энтерпрайзный бездушный хуяк-хуяк. Видно, что его давно не вычесыали и лепят всё новое сверху как попало.

Для Чатры, как продукта, инцидент завершен, но сендгрид так просто не отпускает, нас еще ждут веселые приключения. Аккаунт в сендгриде все еще забанен, в тикете по-прежнему тишина. Мы пытаемся даунгрейднуть тариф в сендгриде, но эта мразь не дает даунгрейднуться и отправляет нас в саппорт. Ахаха.

...

Сендгрид давно летит по наклонной

